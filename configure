#! /bin/bash
#
# This file is part of bsconf - a configure replacement.
# Copyright (C) 2005 by Mike Sharov <msharov@users.sourceforge.net>
# This file is free software, distributed under the MIT License.

if [ -z "$CC" ]; then
    for i in gcc g++ cc c++ c89 c99; do
	CC=`which $i 2> /dev/null` && break;
    done;
fi
if [ -z "$CC" ]; then
    echo "No C compiler found" && exit;
fi

PSTDDEF=`echo "#include <stddef.h>"|$CC -E -|grep stddef.h|head -n1|cut -d' ' -f3|cut -d\" -f2`
PINCDIR=`dirname $PSTDDEF`
PLIBDIR=`dirname $PINCDIR`
if [ -d $PLIBDIR/lib ]; then
    PLIBDIR=$PLIBDIR/lib
fi
if [ ! -z "$PINCDIR" ]; then
    PPATHS="$PPATHS --gccincludedir=$PINCDIR"
fi
if [ ! -z "$PLIBDIR" ]; then
    PPATHS="$PPATHS --gcclibdir=$PLIBDIR"
fi
if [ ! -x bsconf -o bsconf.c -nt bsconf -o bsconf.h -nt bsconf ]; then
    $CC -o bsconf bsconf.c
fi
if [ -x bsconf ]; then
    ./bsconf $PPATHS $*;
else
    echo "Configurator build failed";
fi
